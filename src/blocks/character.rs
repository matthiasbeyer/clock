use smart_leds::RGB8;

use super::Block;

pub struct Character {
    chr: char,
    color: RGB8,
    offset: (usize, usize),
}

impl Character {
    pub fn new(chr: char, offset: (usize, usize), color: RGB8) -> Self {
        Self { chr, offset, color }
    }

    pub fn width(&self) -> usize {
        match self.chr {
            ':' => 2,
            '1' => 4,
            'W' => 6,
            _ => 5,
        }
    }
}

impl Block for Character {
    fn render_to_buffer<const X: usize, const Y: usize>(
        &self,
        buffer: &mut crate::data::Buffer<X, Y>,
    ) {
        macro_rules! l {
            (($startx:literal, $starty:literal), ($endx:literal, $endy:literal)) => {
                crate::blocks::line::Line::new(
                    ($startx + self.offset.0, $starty + self.offset.1),
                    ($endx + self.offset.0, $endy + self.offset.1),
                    self.color,
                )
                .render_to_buffer(buffer);
            };
        }

        macro_rules! b {
            ($x:literal, $y:literal) => {
                crate::blocks::xy::XY::new($x + self.offset.0, $y + self.offset.1, self.color)
                    .render_to_buffer(buffer);
            };
        }

        match self.chr {
            'A' => {
                l!((0, 0), (0, 5));
                l!((3, 0), (3, 5));
                l!((0, 5), (3, 5));
                l!((0, 3), (3, 3));
            }
            'B' => {
                l!((0, 0), (0, 5));
                l!((0, 5), (2, 5));
                l!((3, 4), (3, 4));
                l!((1, 3), (2, 3));
                l!((3, 1), (3, 2));
                l!((1, 0), (2, 0));
            }
            'C' => {
                l!((0, 0), (0, 5));
                l!((0, 5), (3, 5));
                l!((1, 0), (3, 0));
            }
            'D' => {
                l!((0, 0), (0, 5));
                l!((0, 5), (2, 5));
                l!((1, 0), (2, 0));
                l!((3, 1), (3, 4));
            }
            'E' => {
                l!((0, 0), (0, 5));
                l!((0, 5), (3, 5));
                l!((1, 3), (3, 3));
                l!((1, 0), (3, 0));
            }
            'F' => {
                l!((0, 0), (0, 5));
                l!((0, 5), (3, 5));
                l!((1, 3), (2, 3));
            }
            'G' => {
                l!((0, 0), (0, 5));
                l!((0, 5), (3, 5));
                l!((3, 4), (3, 5));
                l!((2, 2), (3, 2));
                l!((1, 0), (3, 0));
                l!((3, 0), (3, 2));
            }
            'H' => {
                l!((0, 0), (0, 5));
                l!((3, 0), (3, 5));
                l!((0, 3), (3, 3));
            }
            'I' => {
                l!((1, 0), (1, 5));
            }
            'J' => {
                l!((0, 1), (0, 1));
                l!((1, 0), (2, 0));
                l!((3, 1), (3, 5));
                l!((0, 5), (3, 5));
            }
            'K' => {
                l!((0, 0), (0, 5));
                b!(3, 5);
                b!(2, 4);
                b!(1, 3);
                b!(1, 2);
                b!(2, 1);
                b!(3, 0);
            }
            'L' => {
                l!((0, 0), (0, 5));
                l!((0, 0), (3, 0));
            }
            'M' => {
                l!((0, 0), (0, 5));
                l!((3, 0), (3, 5));
                l!((1, 4), (2, 4));
            }
            'N' => {
                l!((0, 0), (0, 5));
                l!((3, 0), (3, 5));
                l!((1, 3), (1, 4));
                l!((2, 1), (2, 2));
            }
            'O' => {
                l!((0, 0), (0, 5));
                l!((3, 0), (3, 5));
                l!((0, 5), (3, 5));
                l!((0, 0), (3, 0));
            }
            'P' => {
                l!((0, 0), (0, 5));
                l!((0, 5), (2, 5));
                l!((3, 4), (3, 4));
                l!((1, 3), (2, 3));
            }
            'Q' => {
                l!((0, 0), (0, 5));
                l!((3, 2), (3, 5));
                l!((0, 5), (3, 5));
                l!((0, 0), (1, 0));
                b!(2, 1);
                b!(3, 0);
            }
            'R' => {
                l!((0, 0), (0, 5));
                l!((0, 5), (2, 5));
                l!((3, 4), (3, 4));
                l!((1, 3), (2, 3));
                l!((3, 0), (3, 2));
            }
            'S' => {
                l!((0, 5), (3, 5));
                l!((0, 3), (0, 5));
                l!((0, 3), (3, 3));
                l!((3, 0), (3, 3));
                l!((0, 0), (3, 0));
            }
            'T' => {
                l!((0, 5), (3, 5));
                l!((2, 0), (2, 5));
            }
            'U' => {
                l!((0, 1), (0, 5));
                l!((3, 1), (3, 5));
                l!((1, 0), (2, 0));
            }
            'V' => {
                l!((0, 2), (0, 5));
                l!((3, 2), (3, 5));
                l!((1, 1), (2, 1));
                l!((1, 0), (2, 0));
            }
            'W' => {
                l!((0, 1), (0, 5));
                l!((4, 1), (4, 5));
                l!((1, 0), (3, 0));
                l!((2, 1), (2, 2));
            }
            'X' => {
                b!(0, 0);
                b!(1, 1);
                b!(2, 2);
                b!(2, 3);
                b!(3, 4);
                b!(4, 5);

                b!(0, 5);
                b!(1, 4);
                b!(3, 1);
                b!(4, 0);
            }
            'Y' => {
                b!(3, 4);
                b!(4, 5);

                b!(0, 5);
                b!(1, 4);

                l!((2, 0), (2, 3));
            }
            'Z' => {
                b!(0, 0);
                b!(1, 1);
                b!(2, 2);
                b!(2, 3);
                b!(3, 4);
                b!(4, 5);

                l!((0, 5), (4, 5));
                l!((0, 0), (4, 0));
            }

            '0' => {
                l!((0, 1), (0, 4));
                l!((3, 1), (3, 4));
                l!((1, 5), (2, 5));
                l!((1, 0), (2, 0));
            }
            '1' => {
                l!((2, 0), (2, 5));
                b!(1, 4);
                b!(0, 3);
            }
            '2' => {
                b!(0, 4);
                l!((1, 5), (2, 5));
                l!((3, 4), (3, 3));
                l!((1, 2), (2, 2));
                b!(0, 1);
                l!((1, 0), (3, 0));
            }
            '3' => {
                l!((3, 1), (3, 2));
                b!(3, 4);
                l!((2, 5), (0, 5));
                l!((2, 3), (0, 3));
                l!((2, 0), (0, 0));
            }
            '4' => {
                l!((3, 0), (3, 5));
                l!((0, 3), (3, 3));
                l!((0, 3), (0, 4));
                b!(1, 5);
            }
            '5' => {
                l!((1, 5), (3, 5));
                l!((0, 3), (0, 5));
                l!((1, 3), (2, 3));
                l!((3, 1), (3, 2));
                l!((0, 0), (2, 0));
            }
            '6' => {
                l!((0, 1), (0, 5));
                l!((1, 5), (2, 5));
                l!((1, 3), (2, 3));
                l!((3, 1), (3, 2));
                l!((1, 0), (2, 0));
            }
            '7' => {
                l!((0, 5), (3, 5));
                l!((3, 3), (3, 5));
                b!(0, 0);
                b!(1, 1);
                b!(2, 2);
            }
            '8' => {
                l!((1, 5), (2, 5));
                l!((1, 3), (2, 3));
                l!((1, 0), (2, 0));

                l!((0, 1), (0, 4));
                l!((3, 1), (3, 4));
            }
            '9' => {
                l!((1, 5), (2, 5));
                b!(0, 4);
                l!((1, 3), (2, 3));
                l!((3, 1), (3, 4));
                l!((1, 0), (2, 0));
            }
            ':' => {
                b!(0, 1);
                b!(0, 4);
            }
            other => panic!("Unsupported character: {}", other),
        }
    }
}
